<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aieseb</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="assets/css/nav.css" />
    <link rel="stylesheet" href="assets/css/mualaf.css" />
    <link rel="stylesheet" href="assets/css/footer.css" />
  </head>

  <body>
    <div class="mualaf">
      <div class="container-mualaf">
        <div x-data="jadwalSholat()" x-init="connect()">
          <div class="mb-3">
            <div class="content-option d-flex">
              <input
                type="text"
                class="form-control"
                x-model="search"
                placeholder="Cari Kota"
              />
              <div class="content-option-list">Pilih Daerah</div>

              <select class="form-select" @change="jadwal($event.target.value)">
                <option selected>Tekan Untuk Melihat</option>
                <template x-for="city in filteredCities" :key="city.id">
                  <option x-text="city.lokasi" :value="city.id"></option>
                </template>
              </select>
            </div>

            <div class="mt-4">
              <template x-if="!loadingJadwal">
                <div>
                  <div class="lokasi-sholat">
                    <h2 class="lokasi-sholat-header">JADWAL SHOLAT UNTUK</h2>
                    <h2 x-text="lokasi"></h2>
                  </div>

                  <div class="table-responsive">
                    <table class="table table-vcenter">
                      <thead>
                        <tr>
                          <th>Tanggal</th>
                          <th>Subuh</th>
                          <th>Dzuhur</th>
                          <th>Ashar</th>
                          <th>Maghrib</th>
                          <th>Isya</th>
                        </tr>
                      </thead>
                      <tbody>
                        <template
                          x-for="jadwal in jadwalSholat"
                          :key="jadwal.date"
                        >
                          <tr>
                            <td x-text="jadwal.tanggal"></td>
                            <td x-text="jadwal.subuh"></td>
                            <td x-text="jadwal.dzuhur"></td>
                            <td x-text="jadwal.ashar"></td>
                            <td x-text="jadwal.maghrib"></td>
                            <td x-text="jadwal.isya"></td>
                          </tr>
                        </template>
                      </tbody>
                    </table>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script>
      let getYearNumber = new Date().getFullYear().toString();
      let getMonth = new Date().getMonth() + 1;
      let monthZero = getMonth.toString().padStart(2, "0");

      function jadwalSholat() {
        return {
          allCity: [],
          jadwalSholat: [],
          loading: true,
          loadingJadwal: true,
          lokasi: "",
          search: "",
          selectedCityId: "1638",
          connect() {
            fetch("https://api.myquran.com/v2/sholat/kota/semua")
              .then((response) => response.json())
              .then((data) => {
                this.allCity = data.data;
                this.loading = false;

                const defaultCity = this.allCity.find(
                  (city) => city.id === this.selectedCityId
                );
                if (defaultCity) {
                  this.jadwal(defaultCity.id);
                }
              })
              .catch((error) => {
                console.error("Error fetching data:", error);
                this.loading = false;
              });
          },
          jadwal(id) {
            this.loadingJadwal = true;
            fetch(
              `https://api.myquran.com/v2/sholat/jadwal/${id}/${getYearNumber}/${monthZero}`
            )
              .then((response) => response.json())
              .then((data) => {
                this.jadwalSholat = data.data.jadwal;
                this.lokasi = data.data.lokasi;
                this.loadingJadwal = false;
                console.log(this.lokasi);
              })
              .catch((error) => {
                console.error("Error fetching data:", error);
                this.loadingJadwal = false;
              });
          },
          filteredCities() {
            return this.allCity.filter((city) => {
              return city.lokasi
                .toLowerCase()
                .includes(this.search.toLowerCase());
            });
          },
        };
      }
    </script>
    <script src="assets/js/script.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
